# AI Visual Code Review Project - Cline Instructions

I am Cline, an expert software engineer working on **AI Visual Code Review** - a comprehensive visual code review system with AI integration for any Git repository.

## ğŸš¨ MANDATORY COMMIT WORKFLOW

**NEVER commit directly with `git commit -m`. ALWAYS follow this process:**

1. **Create COMMIT_MESSAGE.md** with structured format (see guide below)
2. **Stage changes:** `git add -A`
3. **Commit using file:** `git commit -F COMMIT_MESSAGE.md`
4. **Clean up:** Remove COMMIT_MESSAGE.md after successful commit

This ensures consistent, detailed commit messages with proper formatting every time.

## ğŸ” **AI Visual Code Review Project Overview**

### **Project Purpose**

- **Visual Code Review System** with GitHub-like interface
- **AI Integration** for structured code review exports
- **Multi-Platform Support**: CLI, Web interface, VSCode extension
- **Enterprise Security** with comprehensive protection layers
- **Production Ready** with extensive testing and documentation

### **Technology Stack**

- **Runtime:** Node.js 14+ with Express.js
- **Language:** JavaScript (server), TypeScript (VSCode extension)
- **Frontend:** Vanilla JavaScript with advanced DOM manipulation
- **Testing:** Jest + SuperTest for comprehensive coverage
- **Security:** Multiple protection layers, rate limiting, input validation

### **Project Structure**

- `server.js` - Main Express server with security hardening
- `bin/ai-review.js` - CLI interface and command processing
- `services/diffService.js` - Git diff parsing and security validation
- `public/index.html` - Interactive web interface with GitHub-like styling
- `vscode-extension/` - Native VSCode integration
- `test/` - Comprehensive security and functionality tests

## ğŸ¯ **Development Guidelines**

### **Security First Approach**

- **Always validate inputs** - No user input should be trusted
- **Prevent command injection** - Use allowlisted Git commands only
- **Path traversal protection** - Validate all file paths
- **Rate limiting** - Implement on all public endpoints
- **Security headers** - Set comprehensive headers on all responses

### **Code Quality Standards**

- **Error handling** - Wrap async operations with proper error handling
- **Memory management** - Implement cleanup for long-running processes
- **Input sanitization** - Validate and sanitize all user inputs
- **Performance** - Use caching and async operations appropriately
- **Documentation** - Comment complex logic and security measures

### **Testing Requirements**

- **Security testing** - Test for injection attacks, XSS, path traversal
- **API testing** - Cover all endpoints including error scenarios
- **Rate limiting** - Verify limits are enforced correctly
- **Cross-platform** - Ensure compatibility across operating systems

## ğŸš€ **Key Features to Maintain**

### **Visual Interface**

- GitHub-like dark theme with professional styling
- Interactive diff viewer with syntax highlighting
- Line-by-line commenting with templates
- File selection for AI export control
- Real-time notifications and loading states

### **AI Integration**

- Structured exports optimized for ChatGPT/Claude
- Comprehensive review checklists (security, performance, accessibility)
- Multiple export formats (unified and individual file reviews)
- Context-aware analysis for different file types

### **Security Features**

- Multi-layer protection against common attacks
- Rate limiting with configurable windows
- Input validation and sanitization
- Security headers and CORS configuration
- Production-safe error handling

## âš ï¸ **Common Pitfalls to Avoid**

### **Security Mistakes**

- âŒ Don't trust user input without validation
- âŒ Don't execute arbitrary commands
- âŒ Don't expose internal errors in production
- âŒ Don't skip rate limiting on new endpoints
- âŒ Don't allow path traversal in file operations

### **Development Mistakes**

- âŒ Don't skip error handling for async operations
- âŒ Don't ignore memory leaks in long-running processes
- âŒ Don't hardcode file paths or configuration
- âŒ Don't skip input sanitization
- âŒ Don't forget to update tests for new features

### **Architecture Mistakes**

- âŒ Don't tightly couple components
- âŒ Don't bypass the security validation layers
- âŒ Don't ignore performance implications
- âŒ Don't skip documentation for complex logic

## ğŸ”„ **Development Workflow**

### **Before Making Changes**

1. **Understand the security implications** - Consider how changes affect security
2. **Review existing patterns** - Follow established patterns in the codebase
3. **Plan error handling** - Consider failure scenarios and recovery
4. **Update tests** - Ensure comprehensive test coverage

### **Code Review Checklist**

- [ ] Security validation for all inputs
- [ ] Proper error handling and recovery
- [ ] Memory leak prevention
- [ ] Cross-platform compatibility
- [ ] Documentation for complex logic
- [ ] Test coverage for new functionality

---

## **Emoji Guide for Enhanced Commit Messages**

### **Standard Type Emojis**

1. **feat:** (Feature)

```
âœ¨ feat: add user authentication
ğŸ¯ feat: implement search functionality
ğŸŒŸ feat: add new dashboard
```

2. **fix:** (Bug Fix)

```
ğŸ› fix: resolve login page crash
ğŸš‘ fix: patch critical bug
ğŸ©¹ fix: minor bug fixes
```

3. **docs:** (Documentation)

```
ğŸ“š docs: update README
ğŸ“ docs: add API documentation
ğŸ“– docs: improve code comments
```

4. **style:** (Formatting)

```
ğŸ’„ style: format code
ğŸ¨ style: improve structure
ğŸ” style: lint fixes
```

5. **refactor:** (Code Refactoring)

```
â™»ï¸ refactor: restructure authentication
ğŸ”¨ refactor: improve code organization
ğŸ› ï¸ refactor: optimize logic
```

6. **test:** (Testing)

```
âœ… test: add unit tests
ğŸ§ª test: update test cases
ğŸ”¬ test: add integration tests
```

7. **chore:** (Maintenance)

```
ğŸ”§ chore: update dependencies
ğŸš§ chore: work in progress
âš™ï¸ chore: configure settings
```

8. **perf:** (Performance)

```
âš¡ perf: improve loading speed
ğŸš€ perf: optimize performance
â±ï¸ perf: reduce runtime
```

9. **ci:** (Continuous Integration)

```
ğŸ‘· ci: add CI pipeline
ğŸ”„ ci: update workflow
âš—ï¸ ci: modify build process
```

10. **build:** (Build System)

```
ğŸ“¦ build: update dependencies
ğŸ—ï¸ build: modify webpack config
ğŸ”¨ build: change build tools
```

### **Security-Specific Emojis**

```
ğŸ”’ security: add authentication
ğŸ›¡ï¸ security: enhance protection
ğŸš¨ security: fix vulnerability
âš ï¸ security: add validation
```

### **AI Code Review Specific Emojis**

```
ğŸ” review: improve code analysis
ğŸ¤– ai: enhance AI integration
ğŸ“Š export: improve review export
ğŸ’¬ comment: update commenting system
```

## **Commit Message Creation Guide**

### **Step-by-Step Process**

#### **1. Analyze Your Changes**

- What files were modified?
- What functionality was added, removed, or fixed?
- Are there any security implications?
- Does this affect the AI integration?

#### **2. Choose the Right Type**

```
Is it a bug fix? â†’ fix
Is it a new feature? â†’ feat
Is it documentation? â†’ docs
Is it security-related? â†’ security
Is it refactoring? â†’ refactor
Is it performance improvement? â†’ perf
Is it testing related? â†’ test
Is it build/dependency related? â†’ build
Is it CI/CD related? â†’ ci
Is it maintenance/cleanup? â†’ chore
```

#### **3. Add Appropriate Scope**

```
feat(auth): add OAuth2 support
fix(api): resolve timeout issue
security(validation): add input sanitization
docs(readme): update installation steps
```

### **Templates for AI Code Review Project**

#### **Security Fix Template**

```
ğŸ”’ security(component): brief description of security fix

Explain what vulnerability was fixed and how.
Include impact assessment and prevention measures.

- Security improvement 1
- Security improvement 2

Fixes #issue-number
```

#### **Feature Template**

```
âœ¨ feat(area): brief description of feature

Explain what this feature does and why it's needed.
Include any AI integration or review improvements.

- Key feature point 1
- Key feature point 2

Closes #issue-number
```

### **Commit Process Using COMMIT_MESSAGE.md**

1. **Create COMMIT_MESSAGE.md** with full commit details:

   ```markdown
   ğŸ”’ security(validation): add input sanitization

   ## Problem
   User inputs were not properly sanitized, allowing potential XSS attacks

   ## Solution
   - Added comprehensive input validation
   - Implemented HTML escaping
   - Added security tests

   ## Impact
   - Prevents XSS vulnerabilities
   - Improves overall security posture
   ```

2. **Stage changes:** `git add -A`
3. **Commit using file:** `git commit -F COMMIT_MESSAGE.md`
4. **Clean up:** Remove COMMIT_MESSAGE.md after successful commit

---

This guide ensures consistent, secure, and well-documented development practices for the AI Visual Code Review project.
